<div class="search-container">
  <div class="search-header">
    <h1>üé¨ Catalogue Project</h1>
    <p class="subtitle">Search for TV programmes and broadcasts</p>
  </div>

  <!-- Search bar -->
  <form class="search-form" (ngSubmit)="onSubmit($event)">
    <div class="search-input-group">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        name="searchTerm"
        placeholder="Search for a programme... (e.g. Breaking Bad, Game of Thrones)"
        class="search-input"
        [class.error]="error"
      />
      <button
        type="submit"
        class="search-button"
        [disabled]="loading"
      >
        {{ loading ? 'üîÑ Searching...' : 'üîç Search' }}
      </button>
    </div>

    <!-- Error message -->
    @if (error) {
      <div class="error-message">
        ‚ö†Ô∏è {{ error }}
      </div>
    }
  </form>

  <!-- Loading spinner -->
  @if (loading) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Searching...</p>
    </div>
  }

  <!-- Results -->
  @if (searched && !loading) {
    <div class="results-section">
      <h2 class="results-title">
        {{ results.length > 0 ? results.length + ' programme(s) found' : 'No results' }}
      </h2>

      @if (results.length === 0) {
        <div class="no-results">
          <p>üòï No programmes matches your search.</p>
          <p class="hint">Try another title or check the spelling.</p>
        </div>
      }

      @if (results.length > 0) {
        <!-- Data table -->
        <div class="table-container">
          <table class="results-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Year</th>
                <th>Original Title</th>
                <th>Format</th>
                <th>Genre</th>
                <th>Subgenre</th>
                <th>IMDB ID</th>
                <th>Director</th>
                <th>Producer Companies</th>
                <th>Host/Cast</th>
                <th>Simply Data</th>
                <th>Launches</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (item of results; track item.programme.ID) {
                <tr class="table-row" (click)="viewProgramme(item.programme.ID)">
                  <td class="id-column">{{ item.programme.ID }}</td>
                  <td class="name-column">
                    <strong>{{ item.programme.NAME || '-' }}</strong>
                  </td>
                  <td class="year-column">{{ item.programme.YEAR || '-' }}</td>
                  <td class="title-column">{{ item.programme.ORIGINAL_TITLE || '-' }}</td>
                  <td class="format-column">
                    <span
                      class="badge-format"
                      [class.badge-format-different]="isFormatDifferentFromTitle(item.programme)"
                    >
                      {{ item.programme.FORMAT_TITLE || '-' }}
                    </span>
                  </td>
                  <td class="genre-column">{{ item.programme.GENRE_TITLE || '-' }}</td>
                  <td class="subgenre-column">{{ item.programme.SUBGENRE_TITLE || '-' }}</td>
                  <td class="imdb-column">
                    @if (item.programme.ID_IMDB) {
                      <a
                        href="https://www.imdb.com/title/{{ item.programme.ID_IMDB }}"
                        target="_blank"
                        (click)="$event.stopPropagation()"
                        class="imdb-link"
                      >
                        {{ item.programme.ID_IMDB }}
                      </a>
                    } @else {
                      <span>-</span>
                    }
                  </td>
                  <td class="director-column" [title]="item.programme.DIRECTOR || ''">
                    {{ truncateText(item.programme.DIRECTOR, 50) }}
                  </td>
                  <td class="producer-column" [title]="item.programme.PRODUCERS_NAMES || ''">
                    {{ truncateText(item.programme.PRODUCERS_NAMES, 50) }}
                  </td>
                  <td class="cast-column" [title]="item.programme.HOST_CAST || ''">
                    {{ truncateText(item.programme.HOST_CAST, 50) }}
                  </td>
                  <td class="simply-column">
                    <span
                      [class]="item.simplyDataStatus === 'Linked' ? 'badge-linked' : 'badge-not-linked'"
                    >
                      {{ item.simplyDataStatus || 'Not Linked' }}
                    </span>
                  </td>
                  <td class="launches-column">
                    <span class="badge-launches">{{ item.launches.length }}</span>
                  </td>
                  <td class="actions-column">
                    <button
                      class="view-btn"
                      (click)="viewProgramme(item.programme.ID); $event.stopPropagation()"
                    >
                      View ‚Üí
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>
  }
</div>
