<div class="details-container">
  <!-- Bouton retour -->
  <button class="back-button" (click)="goBack()">
    ‚Üê Retour √† la recherche
  </button>

  <!-- Loading -->
  @if (loading) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Chargement des d√©tails...</p>
    </div>
  }

  <!-- Erreur -->
  @if (error && !loading) {
    <div class="error-box">
      <h2>‚ùå Erreur</h2>
      <p>{{ error }}</p>
      <button class="btn-primary" (click)="goBack()">Retour</button>
    </div>
  }

  <!-- Contenu principal -->
  @if (programme && !loading) {
    <div class="content">
      <!-- Header du programme -->
      <div class="programme-header">
        <div class="header-content">
          <h1 class="programme-title">
            {{ programme.ORIGINAL_TITLE || programme.NAME }}
          </h1>
          @if (programme.YEAR) {
            <span class="year-badge">{{ programme.YEAR }}</span>
          }
        </div>

        @if (programme.NAME && programme.NAME !== programme.ORIGINAL_TITLE) {
          <p class="alternative-title">{{ programme.NAME }}</p>
        }
      </div>

      <!-- Informations du programme -->
      <div class="programme-info-card">
        <h2 class="section-title">üìã Informations du programme</h2>

        <div class="info-grid">
          @if (programme.EXECUTIVE_PRODUCER) {
            <div class="info-item">
              <span class="info-label">Producteur ex√©cutif</span>
              <span class="info-value">{{ programme.EXECUTIVE_PRODUCER }}</span>
            </div>
          }

          @if (programme.HOST_CAST) {
            <div class="info-item">
              <span class="info-label">Casting / Pr√©sentateur</span>
              <span class="info-value">{{ programme.HOST_CAST }}</span>
            </div>
          }

          @if (programme.DIRECTOR) {
            <div class="info-item">
              <span class="info-label">R√©alisateur</span>
              <span class="info-value">{{ programme.DIRECTOR }}</span>
            </div>
          }

          @if (programme.ID_IMDB) {
            <div class="info-item">
              <span class="info-label">IMDB ID</span>
              <span class="info-value">{{ programme.ID_IMDB }}</span>
            </div>
          }
        </div>

        @if (programme.SUMMARY) {
          <div class="summary-section">
            <h3 class="subsection-title">R√©sum√©</h3>
            <p class="summary-text">{{ programme.SUMMARY }}</p>
          </div>
        }

        @if (programme.DESCRIPTION && programme.DESCRIPTION !== programme.SUMMARY) {
          <div class="description-section">
            <h3 class="subsection-title">Description</h3>
            <p class="description-text">{{ programme.DESCRIPTION }}</p>
          </div>
        }
      </div>

      <!-- Launches -->
      <div class="launches-card">
        <h2 class="section-title">üì∫ Launches ({{ launches.length }})</h2>

        @if (launches.length === 0) {
          <p class="no-data">Aucun launch disponible pour ce programme.</p>
        } @else {
          <div class="launches-grid">
            @for (launch of launches; track launch.ID) {
              <div class="launch-item">
                <h3 class="launch-title">{{ launch.LOCAL_TITLE || launch.TRANSLATED_TITLE }}</h3>

                <div class="launch-details">
                  @if (launch.LAUNCH_DATE) {
                    <span class="detail-item">
                      üìÖ {{ formatDate(launch.LAUNCH_DATE) }}
                    </span>
                  }

                  @if (launch.NUMBER_OF_EPISODES) {
                    <span class="detail-item">
                      üé¨ {{ launch.NUMBER_OF_EPISODES }} √©pisode(s)
                    </span>
                  }

                  @if (launch.TYPICAL_DURATION) {
                    <span class="detail-item">
                      ‚è±Ô∏è {{ launch.TYPICAL_DURATION }} min
                    </span>
                  }
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Pays disponibles -->
      <div class="countries-card">
        <h2 class="section-title">üåç Diffusions par pays ({{ availableCountries.length }})</h2>

        @if (availableCountries.length === 0) {
          <p class="no-data">Aucune diffusion trouv√©e dans les bases MyETV.</p>
        } @else {
          <p class="instruction">Cliquez sur un pays pour voir les d√©tails des diffusions</p>

          <div class="countries-grid">
            @for (country of availableCountries; track country) {
              <button
                class="country-button"
                [class.active]="selectedCountry === country"
                (click)="loadCountryBroadcasts(country)"
              >
                {{ country }}
                @if (selectedCountry === country) {
                  <span class="arrow">‚ñº</span>
                } @else {
                  <span class="arrow">‚ñ∂</span>
                }
              </button>
            }
          </div>

          <!-- Broadcasts du pays s√©lectionn√© -->
          @if (selectedCountry) {
            <div class="broadcasts-section">
              <h3 class="subsection-title">üì° Diffusions en {{ selectedCountry }}</h3>

              @if (loadingBroadcasts) {
                <div class="loading-small">
                  <div class="spinner-small"></div>
                  <span>Chargement...</span>
                </div>
              }

              @if (!loadingBroadcasts && countryBroadcasts.length === 0) {
                <p class="no-data">Aucune diffusion trouv√©e pour ce pays.</p>
              }

              @if (!loadingBroadcasts && countryBroadcasts.length > 0) {
                <div class="broadcasts-table-wrapper">
                  <table class="broadcasts-table">
                    <thead>
                      <tr>
                        <th>Date</th>
                        <th>Heure d√©but</th>
                        <th>Dur√©e</th>
                        <th>Audience (RAT)</th>
                        <th>TVR</th>
                        <th>Reach</th>
                        <th>Share</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (broadcast of countryBroadcasts; track broadcast.ID_BROADCAST) {
                        <tr>
                          <td>{{ formatDate(broadcast.BROADCAST_DATE) }}</td>
                          <td>{{ formatTime(broadcast.BEGIN_TIME) }}</td>
                          <td>{{ broadcast.DURATION }} min</td>
                          <td>{{ broadcast.RAT_PERCENTAGE || 'N/A' }}</td>
                          <td>{{ broadcast.TVR_PERCENTAGE || 'N/A' }}</td>
                          <td>{{ broadcast.RCH_PERCENTAGE || 'N/A' }}</td>
                          <td>{{ broadcast.SHR_PERCENTAGE || 'N/A' }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              }
            </div>
          }
        }
      </div>

      <!-- Donn√©es Simply -->
      @if (simply && (simply.programmes.length > 0 || simply.broadcasts.length > 0)) {
        <div class="simply-card">
          <h2 class="section-title">üé¨ Donn√©es Simply</h2>

          @if (simply.programmes.length > 0) {
            <div class="simply-programmes">
              @for (prog of simply.programmes; track prog.ID) {
                <div class="simply-programme-item">
                  <h3 class="simply-title">{{ prog.TITLE }}</h3>

                  <div class="simply-details">
                    @if (prog.CATEGORY) {
                      <span class="badge">{{ prog.CATEGORY }}</span>
                    }

                    @if (prog.GENRE_1_NAME) {
                      <span class="badge genre">{{ prog.GENRE_1_NAME }}</span>
                    }

                    @if (prog.GENRE_2_NAME) {
                      <span class="badge genre">{{ prog.GENRE_2_NAME }}</span>
                    }

                    @if (prog.RELEASE_YEAR) {
                      <span class="badge year">{{ prog.RELEASE_YEAR }}</span>
                    }
                  </div>

                  @if (prog.DESCRIPTION) {
                    <p class="simply-description">{{ prog.DESCRIPTION }}</p>
                  }

                  <div class="simply-meta">
                    @if (prog.PRODUCTION_COMPANY) {
                      <div class="meta-item">
                        <strong>Production:</strong> {{ prog.PRODUCTION_COMPANY }}
                      </div>
                    }

                    @if (prog.PRODUCTION_COUNTRIES) {
                      <div class="meta-item">
                        <strong>Pays:</strong> {{ prog.PRODUCTION_COUNTRIES }}
                      </div>
                    }

                    @if (prog.ID_IMDB) {
                      <div class="meta-item">
                        <strong>IMDB:</strong> {{ prog.ID_IMDB }}
                      </div>
                    }

                    @if (prog.ID_TMDB) {
                      <div class="meta-item">
                        <strong>TMDB:</strong> {{ prog.ID_TMDB }}
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          }

          @if (simply.broadcasts.length > 0) {
            <div class="simply-broadcasts">
              <h3 class="subsection-title">Diffusions Simply ({{ simply.broadcasts.length }})</h3>

              <div class="simply-broadcasts-list">
                @for (broadcast of simply.broadcasts; track broadcast.ID) {
                  <div class="simply-broadcast-item">
                    <strong>{{ broadcast.BROADCAST_TITLE }}</strong>
                    <span class="broadcast-time">
                      {{ formatDate(broadcast.START_TIME) }} - {{ formatTime(convertDateToTime(broadcast.START_TIME)) }}
                    </span>
                    @if (broadcast.DURATION) {
                      <span class="broadcast-duration">{{ broadcast.DURATION }} min</span>
                    }
                  </div>
                }
              </div>
            </div>
          }
        </div>
      }
    </div>
  }
</div>

